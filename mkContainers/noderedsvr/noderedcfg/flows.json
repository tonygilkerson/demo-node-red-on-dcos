[{"type":"tab","id":"1cacabe3.36b064","label":"test flow","_def":{"defaults":{"label":{"value":""}}}},{"type":"tab","id":"706c7407.8c38fc","label":"test flow","_def":{"defaults":{"label":{"value":""}}}},{"type":"tab","id":"87b0ac16.d1ff1","label":"Service 0","_def":{"defaults":{"label":{"value":""}}}},{"type":"tab","id":"e556e45b.648c58","label":"Service 1","_def":{"defaults":{"label":{"value":""}}}},{"id":"1a870f79.ae0e91","type":"amqp-server","z":"","host":"p1.dcos","port":"10003","vhost":"demo-vhost","keepalive":"30","usetls":false,"verifyservercert":true,"usetopology":false,"topology":"{\n\t\"exchanges\": [\n\t\t{\"name\": \"exchange1\", \"type\": \"direct\", \"options\": {\"durable\": false}},\n\t\t{\"name\": \"exchange2\"}\n\t],\n\t\"queues\": [\n\t\t{\"name\": \"queue1\", \"options\": {\"messageTtl\": 60000}},\n\t\t{\"name\": \"queue2\"}\n\t],\n\t\"bindings\": [\n\t\t{\"source\": \"exchange1\", \"queue\": \"queue1\", \"pattern\": \"debug\", \"args\": {}},\n\t\t{\"source\": \"exchange1\", \"exchange\": \"exchange2\", \"pattern\": \"error\"},\n\t\t{\"source\": \"exchange2\", \"queue\": \"queue2\"}\n\t]\n}"},{"id":"f6918e5.c8d247","type":"http in","z":"1cacabe3.36b064","name":"test","url":"/test","method":"get","swaggerDoc":"","x":140,"y":120,"wires":[["597d85d4.d140cc"]]},{"id":"70b22ed7.2d977","type":"http response","z":"1cacabe3.36b064","name":"","x":630,"y":120,"wires":[]},{"id":"597d85d4.d140cc","type":"function","z":"1cacabe3.36b064","name":"got it!","func":"msg.payload = \"got it!\";\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":120,"wires":[["70b22ed7.2d977"]]},{"id":"bb3830ed.cfa5a","type":"debug","z":"706c7407.8c38fc","name":"","active":true,"console":"false","complete":"payload.trace","x":1001.5,"y":373.8500061035156,"wires":[]},{"id":"53dd188f.96eeb8","type":"amqp in","z":"706c7407.8c38fc","name":"router","topic":"","iotype":"4","ioname":"chrq","server":"1a870f79.ae0e91","x":81.5,"y":273.8500061035156,"wires":[["73df5b36.b4a9e4"]]},{"id":"73df5b36.b4a9e4","type":"function","z":"706c7407.8c38fc","name":"restore FC","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", restore FC\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":161.5,"y":373.8500061035156,"wires":[["61115e74.cc0f9"]]},{"id":"61115e74.cc0f9","type":"switch","z":"706c7407.8c38fc","name":"select org","property":"payload.org","propertyType":"msg","rules":[{"t":"eq","v":"org1","vt":"str"},{"t":"eq","v":"org2","vt":"str"}],"checkall":"true","outputs":2,"x":331.5,"y":373.8500061035156,"wires":[["d80b8599.b1aee8"],["995e2655.d9f6f8"]]},{"id":"d80b8599.b1aee8","type":"switch","z":"706c7407.8c38fc","name":"org1 select service","property":"payload.service","propertyType":"msg","rules":[{"t":"eq","v":"s0","vt":"str"},{"t":"eq","v":"s1","vt":"str"},{"t":"eq","v":"s2","vt":"str"}],"checkall":"true","outputs":3,"x":526,"y":277.29998779296875,"wires":[["fe4c4f97.80627"],["814075c7.8def38"],["6d5de81f.aa6f08"]]},{"id":"995e2655.d9f6f8","type":"switch","z":"706c7407.8c38fc","name":"org2 select service","property":"payload.service","propertyType":"msg","rules":[{"t":"eq","v":"s0","vt":"str"},{"t":"eq","v":"s1","vt":"str"},{"t":"eq","v":"s2","vt":"str"}],"checkall":"true","outputs":3,"x":521.5,"y":453.8500061035156,"wires":[["36ca25b0.4d56ba"],["ad973351.2659c"],["b40ec577.12a998"]]},{"id":"fe4c4f97.80627","type":"function","z":"706c7407.8c38fc","name":"o1 s0","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", o1s0 STOP\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":213.85000610351562,"wires":[["bb3830ed.cfa5a"]]},{"id":"814075c7.8def38","type":"function","z":"706c7407.8c38fc","name":"o1 s1","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", o1s1 STOP\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":273.8500061035156,"wires":[["bb3830ed.cfa5a"]]},{"id":"6d5de81f.aa6f08","type":"function","z":"706c7407.8c38fc","name":"o1 s2","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", o1s2 STOP\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":333.8500061035156,"wires":[["bb3830ed.cfa5a"]]},{"id":"36ca25b0.4d56ba","type":"function","z":"706c7407.8c38fc","name":"o2 s0","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", o2s0 STOP\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":393.8500061035156,"wires":[["bb3830ed.cfa5a"]]},{"id":"ad973351.2659c","type":"function","z":"706c7407.8c38fc","name":"o2 s1","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", o2s1 STOP\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":453.8500061035156,"wires":[["bb3830ed.cfa5a"]]},{"id":"b40ec577.12a998","type":"function","z":"706c7407.8c38fc","name":"o2 s2","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", o2s2 STOP\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":721.5,"y":513.8500061035156,"wires":[["bb3830ed.cfa5a"]]},{"id":"d8ce9a9a.f5bea8","type":"amqp out","z":"87b0ac16.d1ff1","name":"router","routingkey":"","iotype":"4","ioname":"chrq","server":"1a870f79.ae0e91","x":310,"y":160,"wires":[]},{"id":"46fc59cc.3ca068","type":"inject","z":"87b0ac16.d1ff1","name":"s0 faker","topic":"","payload":"{   \"organizationId\": \"org1\",   \"eventId\": \"eventId-GUID\",   \"eventDateTime\": \"20170205T23:25:32.000+0000\",   \"eventType\": \"INIT\",   \"documentType\": \"ORDER\",   \"documentName\": \"fileName123.dat\",   \"serviceInstanceId\": \"serviceInstanc-GUID\",   \"serviceName\": \"Fake Order Gateway Service\",   \"serviceType\": \"FTP-Protocol\",   \"serviceLocation\": \"DC01.US\",   \"flowContext\": {     \"testProdFlag\": \"TEST\",     \"accountCode\": \"ACCT123\"   },   \"payloadAttachments\": [     {       \"fileName\": \"fileName123.dat\",       \"fileStorageId\": \"storage-GUID\",       \"charEncoding\": \"UTF-8\"     }   ] }","payloadType":"json","repeat":"","crontab":"","once":false,"x":120,"y":140,"wires":[["d8ce9a9a.f5bea8"]]},{"id":"9fc8639a.81ad8","type":"comment","z":"87b0ac16.d1ff1","name":"Service 0 ","info":"# Service 0\nService 0 is a flow initiator. Data from an external system is received by the service \nand sent to the router for where a bespoke flow is performed.\n\nA flow initiator encapsulates access to the routing service. This can take on many forms.\nHere are a few examples:\n* API to access an external system\n* an internet protocol such as FTP can accept data from a put or perfomr a get to retreive data.\n* files system collection\n* API to access an external system\n\n## Flow Initiation Message Construction \nOnce data is recieved by the service it must construct a *Flow Initiation Message* and then\nsend the message to the router exchange to initiate the flow\n\nHere is the fake order message we will use to start the flow\n\n```\n{\n  \"organizationId\": \"org1\",\n  \"eventId\": \"eventId-GUID\",\n  \"eventDateTime\": \"20170205T23:25:32.000+0000\",\n  \"eventType\": \"INIT\",\n  \"documentType\": \"ORDER\",\n  \"documentName\": \"fileName123.dat\",\n  \"serviceInstanceId\": \"serviceInstanc-GUID\",\n  \"serviceName\": \"Fake Order Gateway Service\",\n  \"serviceType\": \"FTP-Protocol\",\n  \"serviceLocation\": \"DC01.US\",\n  \"flowContext\": {\n    \"testProdFlag\": \"TEST\",\n    \"accountCode\": \"ACCT123\"\n  },\n  \"payloadAttachments\": [\n    {\n      \"fileName\": \"fileName123.dat\",\n      \"fileStorageId\": \"storage-GUID\",\n      \"charEncoding\": \"UTF-8\"\n    }\n  ]\n}\n```\n\nHere is the schemp for an initial flow message\n\n```\n{\n  \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n  \"title\": \"Flow Initiation\",\n  \"description\": \"The first message in a flow\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"organizationId\": {\n      \"description\": \"A unique Id for the organization that owns this message.\",\n      \"type\": \"string\"\n    },\n    \"eventId\": {\n      \"description\": \"A globally unique ID for this event.  This will be used for tracking\",\n      \"type\": \"string\"\n    },\n    \"eventDateTime\": {\n      \"description\": \"The date and time on which this event occurred.\",\n      \"type\": \"string\"\n    },\n    \"eventType\": {\n      \"description\": \"The type of event such as INIT, ROUTE,  or TERM \",\n      \"type\": \"string\"\n    },\n    \"senderId\": {\n      \"description\": \"The senderId is specific to the initiating service and may not be globally unique.  For example, with an FTP put the senderId might be the ftp user name.\",\n      \"type\": \"string\"\n    },\n    \"receiverId\": {\n      \"description\": \"The receiverId is specific to the initiating service and may not be globally unique.  For example, with an FTP put the receierId might be the target folder name.\",\n      \"type\": \"string\"\n    },\n    \"documentType\": {\n      \"description\": \"The payload type i.e. 850, ORDER, or it could be more generic such as FILE or BATCH\",\n      \"type\": \"string\"\n    },\n    \"documentName\": {\n      \"description\": \"A name for the payload type such as an Order Number, a File Name, a Batch ID etc.\",\n      \"type\": \"string\"\n    },\n    \"serviceInstanceId\": {\n      \"description\": \"The unique identifier for the initiating service, similar to docker containerId \",\n      \"type\": \"string\"\n    },\n    \"serviceName\": {\n      \"description\": \"The name of the initiating service, similar to docker container name\",\n      \"type\": \"string\"\n    },\n    \"serviceType\": {\n      \"description\": \"The initiating service type, i.e. FTP, AS2, File Gateway, XYX Connector, etc...\",\n      \"type\": \"string\"\n    },\n    \"serviceLocation\": {\n      \"description\": \"The location associated with the initiating service instance.\",\n      \"type\": \"string\"\n    },\n    \"flowContext\": {\n      \"type\": \"object\",\n      \"additionalProperties\": {\n        \"type\": \"string\",\n        \"description\": \"string values\"\n      }\n    },\n    \"payloadAttachments\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"fileName\": {\n            \"type\": \"string\",\n            \"description\": \"The file name\",\n            \"required\": true\n          },\n          \"fileStorageId\": {\n            \"type\": \"string\",\n            \"description\": \"A unique storage id used to retrieve the file if needed\",\n            \"required\": true\n          },\n          \"charEncoding\": {\n            \"type\": \"string\",\n            \"description\": \"A unique storage id used to retrieve the file if needed\",\n            \"required\": true\n          },\n          \"mimeType\": {\n            \"type\": \"string\",\n            \"description\": \"A unique storage id used to retrieve the file if needed\",\n            \"required\": false\n          }\n        },\n        \"description\": \"the value\",\n        \"required\": true\n      }\n    }\n  },\n  \"required\": [\n    \"organizationId\",\n    \"eventID\",\n    \"eventDateTime\",\n    \"eventType\",\n    \"serviceName\",\n    \"serviceType\"\n  ]\n}\n```\n\n\n","x":114,"y":83,"wires":[]},{"id":"897c4b1e.329d08","type":"amqp in","z":"e556e45b.648c58","name":"","topic":"","iotype":"4","ioname":"s1q","server":"1a870f79.ae0e91","x":90,"y":100,"wires":[["4fba985a.c76148"]]},{"id":"a370167f.d6d508","type":"amqp out","z":"e556e45b.648c58","name":"router","routingkey":"","iotype":"4","ioname":"chrq","server":"1a870f79.ae0e91","x":430,"y":100,"wires":[]},{"id":"4fba985a.c76148","type":"function","z":"e556e45b.648c58","name":"s1 service","func":"var trace = String(msg.payload.trace);\ntrace = trace.concat(\", s1 EXEC\");\nmsg.payload.trace = trace;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":120,"wires":[["a370167f.d6d508"]]},{"id":"2242f712.704b18","type":"comment","z":"e556e45b.648c58","name":"service 1","info":"This is the comment for service 1","x":100,"y":40,"wires":[]},{"id":"8ed8973a.096f88","type":"debug","z":"706c7407.8c38fc","name":"","active":true,"console":"false","complete":"false","x":855,"y":68,"wires":[]}]